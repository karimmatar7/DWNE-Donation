<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Steun ons</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    :root {
      --bg:#050505;
      --card:#0d0d0d;
      --accent:#9D1313;
      --accent-hover:#b81616;
      --text:#D9D9D9;
      --muted:#a3a3a3;
      --border:rgba(217,217,217,0.08);
    }

    * { box-sizing:border-box; }

    body {
      font-family:'Inter',system-ui,sans-serif;
      margin:0;
      background:radial-gradient(circle at 25% 25%,#0a0a0a,#050505);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:24px;
    }

    .card {
      background:var(--card);
      padding:40px;
      border-radius:18px;
      border:1px solid var(--border);
      box-shadow:0 6px 30px rgba(0,0,0,0.5);
      width:100%;
      max-width:420px;
      animation:fadeIn .8s ease forwards;
    }

    h1 {
      margin:0 0 24px;
      font-size:2rem;
      font-weight:700;
      text-align:center;
      color:var(--accent);
      text-shadow:0 0 15px rgba(157,19,19,0.3);
    }

    #paymentError {
      display:none;
      margin-bottom:16px;
    }

    form { display:grid; gap:18px; }

    label {
      display:flex;
      flex-direction:column;
      gap:6px;
      font-weight:600;
      font-size:.9rem;
    }

    input[type="text"] {
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.08);
      color:var(--text);
      border-radius:10px;
      padding:10px 12px;
      font-size:1rem;
      outline:none;
    }

    input[type="text"]:focus {
      border-color:var(--accent);
      background:rgba(157,19,19,0.15);
    }

    .amounts {
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
      margin-top:6px;
    }

    .text-terms { display:block; }

    .amount-btn {
      padding:12px 0;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.08);
      background:rgba(255,255,255,0.04);
      color:var(--text);
      font-weight:600;
      cursor:pointer;
      transition:.2s;
    }

    .amount-btn:hover {
      background:rgba(157,19,19,0.25);
      border-color:var(--accent);
    }

    .amount-btn.active {
      background:linear-gradient(135deg,var(--accent),var(--accent-hover));
      border-color:var(--accent);
      box-shadow:0 0 18px rgba(157,19,19,.45);
    }

    .terms {
      display:flex;
      align-items:flex-start;
      gap:10px;
      font-size:.85rem;
      color:var(--muted);
      line-height:1.4;
    }

    .terms input {
      margin-top:3px;
      accent-color: var(--accent);
      cursor:pointer;
    }

    .terms a {
      color:var(--accent-hover);
      text-decoration:underline;
      font-weight:600;
    }

    button.submit {
      margin-top:6px;
      background:linear-gradient(135deg,var(--accent),var(--accent-hover));
      color:#fff;
      border:none;
      padding:14px 18px;
      border-radius:10px;
      cursor:pointer;
      font-size:1rem;
      font-weight:700;
      box-shadow:0 0 18px rgba(157,19,19,0.35);
      transition:.2s;
    }

    button.submit:disabled {
      opacity:.4;
      cursor:not-allowed;
      box-shadow:none;
      transform:none;
    }

    p {
      margin-top:22px;
      text-align:center;
      font-size:.9rem;
      color:var(--muted);
    }

    a {
      color:var(--accent-hover);
      text-decoration:none;
      font-weight:600;
    }

    a:hover { text-decoration:underline; }

    @keyframes fadeIn {
      from { opacity:0; transform:translateY(15px); }
      to { opacity:1; transform:translateY(0); }
    }
  </style>
</head>

<body>
<div class="card">
  <h1>‚ù§Ô∏è Steun ons - De Weg Naar Evenwicht</h1>

  <!-- Error container -->
  <div id="paymentError"></div>

  <form id="donateForm">
    <label>Naam
      <input name="name" type="text" placeholder="Jouw naam" required />
    </label>

    <label>Bedrag
      <div class="amounts">
        <button type="button" class="amount-btn active" data-amount="5">‚Ç¨5</button>
        <button type="button" class="amount-btn" data-amount="1">‚Ç¨1</button>
        <button type="button" class="amount-btn" data-amount="2">‚Ç¨2</button>
        <button type="button" class="amount-btn" data-amount="10">‚Ç¨10</button>
      </div>
    </label>

    <label>Boodschap (optioneel)
      <input name="message" type="text" placeholder="Succes met jullie werk!" />
    </label>

    <div class="terms">
      <input type="checkbox" id="termsCheck" />
      <label class="text-terms" for="termsCheck">
        Ik heb de
        <a href="/Donatievoorwaarden ‚Äì Installatie Warmste Week - Evenwicht.pdf" target="_blank" rel="noopener">
          algemene voorwaarden
        </a>
        gelezen en ga hiermee akkoord.
      </label>
    </div>

    <button class="submit" type="submit" id="donateBtn" disabled>
      üí∏ Doneer
    </button>
  </form>

  <p>
    Live overzicht:
    <a href="/live.html" target="_blank">Bekijk betalingen ‚Üí</a>
  </p>
</div>

<script>
let selectedAmount = 5;

document.querySelectorAll('.amount-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selectedAmount = Number(btn.dataset.amount);
  });
});

const termsCheck = document.getElementById('termsCheck');
const donateBtn = document.getElementById('donateBtn');

termsCheck.addEventListener('change', () => {
  donateBtn.disabled = !termsCheck.checked;
});

document.getElementById('donateForm').addEventListener('submit', async e => {
  e.preventDefault();
  if (!termsCheck.checked) return;

  const form = e.target;
  const payload = {
    name: form.name.value.trim(),
    amount: selectedAmount,
    message: form.message.value || 'Donatie'
  };

  try {
    const res = await fetch('/create-payment', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (res.ok && data.checkoutUrl) {
      window.location.href = data.checkoutUrl;
    } else {
      alert(data.error || 'Kon betaling niet starten');
    }
  } catch (err) {
    alert('Netwerkfout: ' + err.message);
  }
});

// Show payment error messages based on Mollie response
const params = new URLSearchParams(window.location.search);
const error = params.get('error');

if (error) {
  const messages = {
    failed: '‚ùå Betaling mislukt. Er is geen bedrag afgeschreven.',
    canceled: '‚ö†Ô∏è Betaling geannuleerd.',
    expired: '‚è∞ Betaling is verlopen. Probeer opnieuw.',
    open: '‚ÑπÔ∏è Betaling niet afgerond.',
    'invalid-id': '‚ùå Ongeldige betaling.',
    'fetch-failed': '‚ùå Kon betaling niet controleren.'
  };

  const box = document.getElementById('paymentError');
  if (box && messages[error]) {
    box.innerHTML = `<div style="padding:14px; background:#3b0d0d; color:#fff; border-radius:10px;">${messages[error]}</div>`;
    box.style.display = 'block';
  }
}
</script>

</body>
</html>
